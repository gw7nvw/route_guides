<% provide(:title, "Route | "+@route.name) %>
<% @title=" | Route | "+@route.name %>
<%= render 'flash' %>

<script> 
   update_title('<%=@title%>'); 
   document.getElementById("page_status").innerHTML = '';
</script>


<%= render 'shared/error_messages' %>
<%= render 'routes/route_details' %>
   <div class="expandrow" style="margin-top:12px">
     <div class="sectiontitle">
        Routes connecting with this one:
     </div>
   </div>
   <% @route.adjoiningRoutes.each do |r|%>
     <div class="expandrow">
        <div class="sectiontext">
           <li>
              <%=  link_to r.name, '/routes/'+r.id.to_s, remote: true, onclick: %q[linkHandler('r]+r.id.to_s+%q[)], id:  'r'+r.id.to_s  %>
           </li>
        </div>
     </div>
   <% end %>

   <div class="expandrow" style="margin-top:12px">
     <div class="sectiontitle">
        Trips passing through here:
     </div>
   </div>
   <% @route.trips.each do |r|%>
     <div class="expandrow">
        <div class="sectiontext">
           <li>
              <%=  link_to r.name+" by "+r.createdBy.name, '/trips/'+r.id.to_s, remote: true, onclick: %q[linkHandler('r]+r.id.to_s+%q[)], id:  'r'+r.id.to_s  %>
           </li>
        </div>
     </div>
   <% end %>

<%= form_for  @route, :html => {:name => 'routeform'}, remote: true  do |f| %>
      <input  type="hidden" id="route_startplace_location" name="route[startplace_location]" type="text" <%if @route.startplace %>value='<%=@route.startplace.location%>'<%end%>>
      <input  type="hidden" id="route_endplace_location" name="route[endplace_location]" type="text" <%if @route.endplace %>value='<%=@route.endplace.location%>'<%end%>>
      <%= f.hidden_field :location, :readonly=>true %>
      <% if signed_in? %>
         <%=  link_to "Edit", '/routes/'+@route.id.to_s+'/edit', class: "btn btn-large btn-primary", remote: true, onclick: "linkHandler('editbutton')", id:  "editbutton"   %>
         <%= f.submit "Add to trip", class: "btn btn-large btn-primary", name: "add", onclick: "linkHandler('addbutton')", id:  "addbutton" %>
      <% end %>
    <% end %>

<script>
  route_init();

  /* specify map click mode */
//  deactivate_all_click();

  /* relad routes layer if we've been asked to */
  if(routesStale) {
       routes_layer.refresh({force: true}); 
       routesStale=false;
  }
</script>

