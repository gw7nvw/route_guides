<div class="place_details">
   <!-- Place title and add/remove buttons if in edit mode-->
   <div class="erow">
      <%  if(signed_in? and !@trip) %>
         <div class="leftbuttons">
            <span title="Edit">
                <%=  link_to image_tag("/assets/pencil_edit.png", :border=>0, :class => 'dock-item'), '/places/'+@place.id.to_s+'/edit', remote: true, onclick: "linkHandler('editbutton')", id:  "editbutton"  %>
            </span>

         </div>
      <% end %>

      <div class="sectiontitle">
          <% link_name=@place.name+"( "+ (if @place.place_owner then @place.place_owner+" " end) + 
                 @place.place_type+" )" %>
          <% if !@history %>
     
             <%= link_to link_name, @place, remote:true,  remote: true, :id => 'home_link', :onclick => "linkHandler('home_link')" %>
          <% else %>
             <%=link_name%>
          <% end %>

      </div>
   </div>

   <%  # convert to NZTM2000 (EPSG:2193) for display 
       fromproj4s= Projection.find_by_id(4326).proj4
       toproj4s= Projection.find_by_id(2193).proj4
       fromproj=RGeo::CoordSys::Proj4.new(fromproj4s)
       toproj=RGeo::CoordSys::Proj4.new(toproj4s)

       xyarr=RGeo::CoordSys::Proj4::transform_coords(fromproj,toproj,@place.location.x, @place.location.y)
       #convery location to readable format
       x=xyarr[0]
       y=xyarr[1]
   %>

   <!-- Place location and max/mix buttons -->
   <div class="erow">
      <%=render :partial => 'expand_buttons',  :locals => {:expName => "fw_p"+@place.id.to_s, :initialSt => @showForward} %>
      <div class="sectiontitle" style="font-weight:normal">
         <%= "NZTM2000: "+x.to_i.to_s+", "+y.to_i.to_s %>
         <% if @place.altitude %>
            <%="(alt: "+@place.altitude.to_i.to_s+"m)"%>
         <% end %>
      </div>
   </div>

   <!-- Place location in collapsable diiv -->
   <div id='<%="fw_p"+@place.id.to_s%>' class="sectiontext" style=<%=if (@showForward==1) then "display:block" else "display:none" end %>>
         <%= simple_format(@place.description).html_safe %>
   </div>


   <!-- Place links (f any) and max/mix buttons -->
   <% if (@place.links) %>
      <% if @place.links.length>0 %>
         <div class="erow">
            <%=render :partial => 'expand_buttons',  :locals => {:expName => "lk_p"+@place.id.to_s, :initialSt => @showLinks} %>
            <div class="sectiontitle">
               Further information:
            </div>
          </div>
          <div id='<%="lk_p"+@place.id.to_s%>' class="sectiontext" style=<%=if (@showLinks==1) then "display:block" else "display:none" end %>>
              <p><%=@place.links %><br/></p>
          </div>
       <% end %>
    <% end %>

   <!-- Place author details (if any) -->
    <% if @place.createdBy_id %>
       <small color="greyLight">
	  Created by: <%= link_to @place.createdBy.name, '/users/'+@place.createdBy_id.to_s, remote: true%> on <%=@place.firstcreated_at%>. Last updated: <%=@place.updated_at%> 
          <% if !@history %>
             <%= link_to "View history", '/history/place-'+@place.id.to_s, remote: true, :id => 'history', :onclick =>"linkHandler('history')" %>
          <% end %>
       </small>
    <% end %>

</div>

<script>
/*    reset_map_controllers(); */
    place_init('<%=@place.location%>',1);
</script>
